{% extends "base.html" %}

{% block title %}Upload - Goswami Whisper{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="bi bi-upload me-2"></i>Upload Recording
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="uploadForm">
                    <!-- File Upload -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="bi bi-file-earmark-music me-1"></i>Upload Audio/Video File
                        </label>
                        <input type="file" class="form-control" name="file" id="fileInput"
                               accept=".mp3,.mp4,.wav,.webm,.m4a,.ogg,.flac,.avi,.mkv">
                        <div class="form-text">
                            Supported formats: MP3, MP4, WAV, WebM, M4A, OGG, FLAC, AVI, MKV (max 500MB)
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="text-center my-4">
                        <span class="bg-white px-3 text-muted">OR</span>
                        <hr class="mt-n3">
                    </div>

                    <!-- URL Input -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="bi bi-link-45deg me-1"></i>Enter URL (YouTube, etc.)
                        </label>
                        <input type="url" class="form-control" name="url" id="urlInput"
                               placeholder="https://youtube.com/watch?v=...">
                        <div class="form-text">
                            Supports YouTube, Vimeo, and many other video platforms
                        </div>
                    </div>

                    <!-- Whisper Model Selection -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="bi bi-cpu me-1"></i>Whisper Model
                        </label>
                        <select class="form-select" name="whisper_model" id="whisperModel">
                            {% for model in whisper_models %}
                            <option value="{{ model }}" {% if model == default_model %}selected{% endif %}>
                                {{ model | capitalize }}
                                {% if model == 'tiny' %} (Fastest, less accurate)
                                {% elif model == 'base' %} (Fast, good accuracy)
                                {% elif model == 'small' %} (Balanced)
                                {% elif model == 'medium' %} (Slower, better accuracy)
                                {% elif model == 'large' %} (Slowest, best accuracy)
                                {% endif %}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">
                            Larger models are more accurate but require more processing time and memory
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i class="bi bi-play-fill me-2"></i>Start Processing
                        </button>
                    </div>
                </form>

                <!-- Processing Info -->
                <div class="alert alert-info mt-4">
                    <h6><i class="bi bi-info-circle me-2"></i>Processing Steps:</h6>
                    <ol class="mb-0">
                        <li>Download/upload the media file</li>
                        <li>Transcribe using Whisper AI</li>
                        <li>Format text with OpenAI GPT-4</li>
                        <li>Index in vector database for search</li>
                    </ol>
                    <small class="text-muted mt-2 d-block">
                        Processing may take several minutes depending on the file length.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        const fileInput = document.getElementById('fileInput');
        const urlInput = document.getElementById('urlInput');

        if (!fileInput.files.length && !urlInput.value.trim()) {
            e.preventDefault();
            alert('Please provide a file or URL');
            return;
        }

        // Show loading overlay
        showLoading('Processing your recording...', 'This may take several minutes. Please do not close this page.');
    });

    // Clear URL when file is selected and vice versa
    document.getElementById('fileInput').addEventListener('change', function() {
        if (this.files.length) {
            document.getElementById('urlInput').value = '';
        }
    });

    document.getElementById('urlInput').addEventListener('input', function() {
        if (this.value.trim()) {
            document.getElementById('fileInput').value = '';
        }
    });
</script>
{% endblock %}

